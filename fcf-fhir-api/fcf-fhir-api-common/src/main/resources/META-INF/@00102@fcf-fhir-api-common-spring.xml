<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd">
	
	<beans profile="root">
	
		<!-- FHIR context and client -->
		<bean id="fhirContextConfigurator"
			  class="org.fujionclinical.fhir.api.common.client.FhirContextConfigurator" />
		
		<bean id="fhirContext"
			  class="org.fujionclinical.fhir.api.common.client.FhirContext">
			<constructor-arg ref="fhirContextConfigurator" />
		</bean>
		
		<bean id="fhirClientFactory"
			  class="org.fujionclinical.fhir.api.common.client.FhirClientFactory">
			<constructor-arg ref="fhirContext" />
		</bean>
		
		<bean id="fhirClient" factory-bean="fhirClientFactory" factory-method="createClient">
			<constructor-arg>
				<bean class="org.fujionclinical.fhir.api.common.client.FhirClientConfigurator"/>
			</constructor-arg>
		</bean>
		
		<bean id="fhirAuthInterceptorRegistry" factory-method="getInstance"
			class="org.fujionclinical.fhir.security.common.AuthInterceptorRegistry"/>
		
		<bean id="fhirAuthInterceptor" abstract="true" 
			class="org.springframework.beans.factory.config.MethodInvokingBean">
			<property name="targetObject" ref="fhirAuthInterceptorRegistry"/>
			<property name="targetMethod" value="register"/>
		</bean>
		
		<bean parent="fhirAuthInterceptor">
			<property name="arguments">
				<map>
					<entry key="Basic" value="org.fujionclinical.fhir.security.common.BasicAuthInterceptor" />
				</map>
			</property>
		</bean>
		
		<bean id="fhirNarrativeService"
			  class="org.fujionclinical.fhir.api.common.core.NarrativeService">
			<constructor-arg ref="fhirContext" />
		</bean>
		
		<bean id="fhirService"
			  class="org.fujionclinical.fhir.api.${fhir.context.version}.common.BaseFhirService">
			<constructor-arg ref="fhirClient" />
		</bean>
		
		<bean id="fhirPatientService" parent="fhirService"
			class="org.fujionclinical.fhir.api.${fhir.context.version}.patient.PatientService" />
		
		<bean id="fhirConditionService" parent="fhirService"
			class="org.fujionclinical.fhir.api.${fhir.context.version}.condition.ConditionService" />
		
		<bean id="fhirMedicationService" parent="fhirService"
			class="org.fujionclinical.fhir.api.${fhir.context.version}.medication.MedicationService" />
		
		<bean id="fhirDocumentService" parent="fhirService"
			class="org.fujionclinical.fhir.api.${fhir.context.version}.document.DocumentService" />
		
		<bean id="documentTypeEnumerator"
			class="org.fujionclinical.fhir.api.${fhir.context.version}.document.DocumentTypeEnumerator">
			<constructor-arg ref="fhirDocumentService" />
		</bean>

		<bean parent="fhirAuthInterceptor">
			<property name="arguments">
				<map>
					<entry key="OAuth2" value="org.fujionclinical.fhir.security.common.OAuth2AuthInterceptor" />
					<entry key="JWT" value="org.fujionclinical.fhir.security.common.JWTAuthInterceptor" />
				</map>
			</property>
		</bean>
		
		<!-- Resource DAOs  -->
		<bean class="org.fujionclinical.fhir.api.${fhir.context.version}.patient.PatientDAO">
			<constructor-arg ref="fhirService" />
		</bean>

		<bean class="org.fujionclinical.fhir.api.${fhir.context.version}.encounter.EncounterDAO">
			<constructor-arg ref="fhirService" />
		</bean>

		<!-- Patient search engine -->
		<bean id="patientSearchEngine"
			  class="org.fujionclinical.fhir.api.${fhir.context.version}.patient.PatientSearch">
			<constructor-arg ref="fhirClient" />
		</bean>
		
		<!-- Encounter search engine -->
		<bean id="encounterSearchEngine"
			  class="org.fujionclinical.fhir.api.${fhir.context.version}.encounter.EncounterSearch">
			<constructor-arg ref="fhirClient" />
		</bean>
		
		<!-- Practitioner search engine -->
		<bean id="practitionerSearchEngine"
			  class="org.fujionclinical.fhir.api.${fhir.context.version}.practitioner.PractitionerSearch">
			<constructor-arg ref="fhirClient" />
		</bean>
		
		<!-- Location search engine -->
		<bean id="locationSearchEngine"
			  class="org.fujionclinical.fhir.api.${fhir.context.version}.location.LocationSearch">
			<constructor-arg ref="fhirClient" />
		</bean>

	</beans>
	
</beans>
